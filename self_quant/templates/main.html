{% extends "layout.html" %}
{% block title %}Graph{% endblock %}
{% block head %}
{{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='js/lib/jqplot/jquery.jqplot.css') }}" />

    <script class="include" src="{{ url_for('static', filename='js/lib/jqplot/jquery.jqplot.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lib/jqplot/plugins/jqplot.dateAxisRenderer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lib/jqplot/plugins/jqplot.canvasTextRenderer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lib/jqplot/plugins/jqplot.canvasAxisLabelRenderer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lib/jqplot/plugins/jqplot.canvasAxisTickRenderer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lib/jqplot/plugins/jqplot.cursor.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lib/jqplot/plugins/jqplot.highlighter.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lib/jqplot/plugins/jqplot.movingAverageRenderer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/graph.js') }}"></script>
    <script>
    var targetPlot, controllerPlot;

    $(function() {
        $("#from").datepicker({
            minDate: new Date({{min_date.year}}, {{min_date.month}} - 1, {{min_date.day}}),
            changeMonth: true,
            changeYear: true,
            numberOfMonths: 1,
            onSelect: function(selectedDate) {
                $("#to").datepicker("option", "minDate", selectedDate);
		controllerPlot.resetZoom();
                jqplot_zoomDates($("#from").datepicker("getDate"), $("#to").datepicker("getDate"), targetPlot);
            }
        });
        $("#to").datepicker({
            maxDate: "0d",
            changeMonth: true,
            changeYear: true,
            numberOfMonths: 1,
            onSelect: function(selectedDate) {
                $("#from").datepicker("option", "maxDate", selectedDate);
		controllerPlot.resetZoom();
                jqplot_zoomDates($("#from").datepicker("getDate"),
                                 $("#to").datepicker("getDate"), targetPlot);
            }
        });
    });
    $(document).ready(function(){
	var series = {{ graphs|safe }};
	$("#from").datepicker("setDate", "{{ initial_days }}");
	$("#to").datepicker("setDate", "0d");
	var plots = show_graph(series, "Weight and Waist");
	targetPlot = plots[0];
	controllerPlot = plots[1];
        jqplot_zoomDates($("#from").datepicker("getDate"),
                         $("#to").datepicker("getDate"), targetPlot);

	$('.button-reset').click(function() {controllerPlot.resetZoom();
                                            });
	$('.button-cust').click(function() {controllerPlot.resetZoom();
                                            jqplot_zoomDates(new Date(2012, 5 - 1, 3),
                                                             new Date(2012, 6 - 1, 26), targetPlot);
                                           });
	$('.button-default').click(function() {controllerPlot.resetZoom();
                                               jqplot_zoomDates($("#from").datepicker("getDate"),
								$("#to").datepicker("getDate"), targetPlot);
                                              });
    });
  </script>
{% endblock %}
{% block content %}
  <div class="jqPlot" id="target" style="height:320px; width:600px;"></div>
  <div class="jqPlot" id="controller" style="margin-top: 30px; height:150px; width:600px;"></div>
  <div id="zoomOptions">
    <button class="button-default">Show last {{ -initial_days }} days</button>
    <button class="button-cust">Show last ? days</button>
    <button class="button-reset">Show all dates</button>
    </div>
  <div id="dates">
    <label for="from">Start Date: </label><input id="from" name="from"type="text" />
    <label for="to"> to </label><input id="to" name="to" type="text" />
  </div>
  <div id="entries">
  </div>
{% endblock %}
